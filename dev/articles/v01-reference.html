<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mirai - Reference Manual • mirai</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mirai - Reference Manual">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-hide-below="1200" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="mirai.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mirai</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.5.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mirai.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-reference.html">mirai - Reference Manual</a></li>
    <li><a class="dropdown-item" href="../articles/v02-promises.html">mirai - Promises (Shiny and Plumber)</a></li>
    <li><a class="dropdown-item" href="../articles/v03-serialization.html">mirai - Serialization (Arrow, ADBC, polars, torch)</a></li>
    <li><a class="dropdown-item" href="../articles/v04-parallel.html">mirai - Communications Backend for R</a></li>
    <li><a class="dropdown-item" href="../articles/v05-opentelemetry.html">mirai - OpenTelemetry</a></li>
    <li><a class="dropdown-item" href="../articles/v06-packages.html">mirai - For Package Authors</a></li>
    <li><a class="dropdown-item" href="../articles/v07-questions.html">mirai - Community FAQs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/09/mirai-2-5-0/">mirai 2.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/27-mirai-240/">mirai 2.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/26-mirai-230/">mirai 2.3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/mirai/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>

     <a href="https://deepwiki.com/r-lib/mirai" class="external-link"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>

  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mirai - Reference Manual</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/mirai/blob/main/vignettes/v01-reference.Rmd" class="external-link"><code>vignettes/v01-reference.Rmd</code></a></small>
      <div class="d-none name"><code>v01-reference.Rmd</code></div>
    </div>

    
    
<p>This is a reference vignette of the package’s core functionality.
Other package vignettes cover additional features.</p>
<div class="section level3">
<h3 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>mirai (Japanese for ‘future’) implements the concept of
<em>futures</em> in R.</p>
<p>Futures represent results from code that will complete later. Code
executes in a separate R process (<em>daemon</em>) and returns results
to the main process (<em>host</em>).</p>
<div class="section level4">
<h4 id="mirai">mirai<a class="anchor" aria-label="anchor" href="#mirai"></a>
</h4>
<p><code><a href="../reference/mirai.html">mirai()</a></code> creates a mirai object from an expression.</p>
<p>It returns immediately without blocking. While the expression
evaluates on a daemon, the host process continues working.</p>
<p>Expressions must be self-contained:</p>
<ul>
<li>Package functions must be namespaced with <code>::</code> or loaded
via <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> within the expression.</li>
<li>Pass required functions, data, or objects explicitly via
<code>...</code> or <code>.args</code>.</li>
</ul>
<blockquote>
<p>This explicit design perfectly matches message-passing parallelism -
attempting to infer global variables introduces unreliability, which we
do not compromise on.</p>
</blockquote>
<p>This example mimics an expensive calculation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org">mirai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  time <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">4.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; &lt; mirai [] &gt;</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; 'unresolved' logi NA</span></span>
<span><span class="fu"><a href="../reference/unresolved.html">unresolved</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Do work whilst unresolved</span></span>
<span></span>
<span><span class="va">m</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 6.218842 3.650785 3.958701 4.108253 4.619849</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] 6.218842 3.650785 3.958701 4.108253 4.619849</span></span></code></pre></div>
<p>A mirai is <em>unresolved</em> until its result is received, then
<em>resolved</em>. Use <code><a href="../reference/unresolved.html">unresolved()</a></code> to check its state.</p>
<p>Access results via <code>m$data</code> once resolved. This will be
the return value, or an ‘errorValue’ if the expression errored, crashed,
or timed out (see <a href="#error-handling">Error Handling</a>).</p>
<p>Use <code>m[]</code> to efficiently wait for and collect the value
instead of repeatedly checking <code>unresolved(m)</code>.</p>
<p>You may also wait efficiently for mirai (or lists of mirai) to
resolve using:</p>
<ul>
<li>
<code><a href="../reference/call_mirai.html">call_mirai()</a></code> returns when all the mirai passed to it
have resolved.</li>
<li>
<code><a href="../reference/race_mirai.html">race_mirai()</a></code> returns when the first mirai passed to it
has resolved.</li>
</ul>
</div>
<div class="section level4">
<h4 id="mirai-advanced">mirai (advanced)<a class="anchor" aria-label="anchor" href="#mirai-advanced"></a>
</h4>
<p>For programmatic use, ‘.expr’ accepts a pre-constructed language
object and ‘.args’ accepts a named list of arguments. The following is
equivalent:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="va">mean</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">2L</span>, mean <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span>.expr <span class="op">=</span> <span class="va">expr</span>, .args <span class="op">=</span> <span class="va">args</span><span class="op">)</span></span>
<span><span class="va">m1</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 3.901930 3.121547 3.593815 2.947067 4.729572</span></span></code></pre></div>
<p>This example performs an asynchronous write operation. Passing
<code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code> to ‘.args’ conveniently provides all objects
from the calling environment (like <code>x</code> and
<code>file</code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">write.csv.async</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">file</span><span class="op">)</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">write.csv.async</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e6</span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="../reference/unresolved.html">unresolved</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Writing file...\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="co"># or do other work</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Writing file...</span></span>
<span><span class="co">#&gt; Writing file...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Write complete:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write complete: TRUE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="daemons">daemons<a class="anchor" aria-label="anchor" href="#daemons"></a>
</h4>
<p>When writing a <code><a href="../reference/mirai.html">mirai()</a></code> call, don’t worry about where or
how it executes. End-users declare available resources using
<code><a href="../reference/daemons.html">daemons()</a></code>.</p>
<p>Without daemons configured, each <code><a href="../reference/mirai.html">mirai()</a></code> call creates a
new local background process (<em>ephemeral daemon</em>).</p>
<p><code><a href="../reference/daemons.html">daemons()</a></code> sets up persistent daemons to evaluate mirai
expressions:</p>
<ul>
<li>Eliminates process startup overhead and limits concurrent
processes.</li>
<li>Cleanup between evaluations ensures each mirai remains
self-contained.</li>
</ul>
<p>See <a href="#local-daemons">local daemons</a> for setup
instructions.</p>
</div>
</div>
<div class="section level3">
<h3 id="error-handling">2. Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h3>
<p>Errors return as a character string with classes ‘miraiError’ and
‘errorValue’.</p>
<p>Use <code><a href="../reference/is_mirai_error.html">is_mirai_error()</a></code> to test for errors:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"occurred with a custom message"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m1</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; 'miraiError' chr Error: occurred with a custom message</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m2</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; 'miraiError' chr Error in mirai::mirai(): missing expression, perhaps wrap in {}?</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_error</a></span><span class="op">(</span><span class="va">m2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_error_value</a></span><span class="op">(</span><span class="va">m2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Error objects include <code>$stack.trace</code> for full stack traces
and <code>$condition.class</code> for original condition classes:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"positive"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="op">{</span><span class="fu">f</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>; <span class="fu">f</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">}</span>, f <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">m3</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; 'miraiError' chr Error in f(1): positive</span></span>
<span></span>
<span><span class="va">m3</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">stack.trace</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; stop("positive")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; f(1)</span></span>
<span><span class="va">m3</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">condition.class</span></span>
<span><span class="co">#&gt; [1] "simpleError" "error"       "condition"</span></span></code></pre></div>
<p>Original error condition elements and <code><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">rlang::abort()</a></code>
metadata are preserved:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"positive"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">abort</a></span><span class="op">(</span><span class="st">"aborted"</span>, meta_uid <span class="op">=</span> <span class="st">"UID001"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m4</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; 'miraiError' chr Error: aborted</span></span>
<span></span>
<span><span class="va">m4</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">meta_uid</span></span>
<span><span class="co">#&gt; [1] "UID001"</span></span></code></pre></div>
<p>User interrupts resolve to class ‘miraiInterrupt’ and ‘errorValue’.
Use <code><a href="../reference/is_mirai_error.html">is_mirai_interrupt()</a></code> to test for interrupts:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/interrupt.html" class="external-link">interrupt</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># simulates a user interrupt</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_interrupt</a></span><span class="op">(</span><span class="va">m4</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Timeouts (via ‘.timeout’) resolve to ‘errorValue’ of 5L, guarding
against hanging processes:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">nanonext</span><span class="fu">::</span><span class="fu"><a href="https://nanonext.r-lib.org/reference/msleep.html" class="external-link">msleep</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, .timeout <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">m5</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; 'errorValue' int 5 | Timed out</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_error</a></span><span class="op">(</span><span class="va">m5</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_interrupt</a></span><span class="op">(</span><span class="va">m5</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_error_value</a></span><span class="op">(</span><span class="va">m5</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><code><a href="../reference/is_mirai_error.html">is_error_value()</a></code> tests for all mirai execution errors,
user interrupts and timeouts.</p>
</div>
<div class="section level3">
<h3 id="local-daemons">3. Local Daemons<a class="anchor" aria-label="anchor" href="#local-daemons"></a>
</h3>
<p>Daemons are persistent background processes that receive
<code><a href="../reference/mirai.html">mirai()</a></code> requests.</p>
<blockquote>
<p>Daemons inherit system configuration (‘.Renviron’, ‘.Rprofile’) and
load default packages. To load only the base package (cutting startup
time in half), set <code>R_SCRIPT_DEFAULT_PACKAGES=NULL</code> before
launching.</p>
</blockquote>
<p>Specify the number of daemons to launch:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>Set <code>n</code> to one less than available cores for optimal
performance. Consider cores reserved for other purposes.</p>
<div class="section level4">
<h4 id="with-dispatcher-default">With Dispatcher (default)<a class="anchor" aria-label="anchor" href="#with-dispatcher-default"></a>
</h4>
<p>The default <code>dispatcher = TRUE</code> creates a background
dispatcher process that manages daemon connections. Tasks dispatch
efficiently in FIFO order, queueing at the dispatcher and sending to
daemons as they become available. The event-driven approach consumes no
resources while waiting and stays synchronized with events.</p>
<p><code><a href="../reference/info.html">info()</a></code> provides current statistics as an integer
vector:</p>
<ul>
<li>
<code>connections</code>: currently active daemons</li>
<li>
<code>cumulative</code>: total daemons ever connected</li>
<li>
<code>awaiting</code>: tasks queued at dispatcher</li>
<li>
<code>executing</code>: tasks currently evaluating</li>
<li>
<code>completed</code>: tasks completed or cancelled</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; connections  cumulative    awaiting   executing   completed </span></span>
<span><span class="co">#&gt;           6           6           0           0           0</span></span></code></pre></div>
<p><code><a href="../reference/status.html">status()</a></code> provides more detail:</p>
<ol style="list-style-type: decimal">
<li>
<code>connections</code>: active connections</li>
<li>
<code>daemons</code>: connection URL</li>
<li>
<code>mirai</code>: task summary</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $connections</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $daemons</span></span>
<span><span class="co">#&gt; [1] "ipc:///tmp/43df2d10f7016fe4c9bdc344"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mirai</span></span>
<span><span class="co">#&gt;  awaiting executing completed </span></span>
<span><span class="co">#&gt;         0         0         0</span></span></code></pre></div>
<p>Set daemons to zero to reset. This reverts to creating a new
background process per request.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="without-dispatcher">Without Dispatcher<a class="anchor" aria-label="anchor" href="#without-dispatcher"></a>
</h4>
<p>With <code>dispatcher = FALSE</code>, daemons connect directly to the
host process:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">6</span>, dispatcher <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Tasks send immediately in round-robin fashion, ensuring even
distribution. However, scheduling isn’t optimal since task duration is
unknown beforehand. Tasks may queue behind long-running tasks while
other daemons sit idle.</p>
<p>This resource-light approach suits similar-length tasks or when
concurrent tasks don’t exceed available daemons.</p>
<p>Status now shows 6 connections and the host URL:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $connections</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $daemons</span></span>
<span><span class="co">#&gt; [1] "ipc:///tmp/f7d6e9c065c1e179c922f75a"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="everywhere">everywhere()<a class="anchor" aria-label="anchor" href="#everywhere"></a>
</h4>
<p><code><a href="../reference/everywhere.html">everywhere()</a></code> evaluates expressions on all daemons and
persists state regardless of cleanup settings:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This keeps the <a href="https://dbi.r-dbi.org/" class="external-link"><code>DBI</code></a>
package loaded. You can also set up common resources like database
connections:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="va">con</span> <span class="op">&lt;&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="va">file</span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Super-assignment makes ‘con’ available globally in all daemons:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"con"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Disconnect everywhere:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>To evaluate in the global environment of each daemon (since mirai
evaluations occur in an environment inheriting from global), use
<code>evalq(envir = globalenv())</code>. Example with
<code>box::use()</code>:</p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">evalq</a></span><span class="op">(</span></span>
<span>    <span class="fu">box</span><span class="fu">::</span><span class="fu">use</span><span class="op">(</span><span class="va">dplyr</span><span class="op">[</span><span class="va">select</span><span class="op">]</span>, <span class="va">mirai</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mirai_map">4. mirai_map<a class="anchor" aria-label="anchor" href="#mirai_map"></a>
</h3>
<p><code><a href="../reference/mirai_map.html">mirai_map()</a></code> performs asynchronous parallel mapping over
lists or vectors.</p>
<blockquote>
<p>Requires <code><a href="../reference/daemons.html">daemons()</a></code> to be set (avoids launching too many
ephemeral daemons).</p>
</blockquote>
<div class="section level4">
<h4 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h4>
<p>Returns immediately. Collect results with <code>x[]</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">3</span>, seed <span class="op">=</span> <span class="fl">1234L</span><span class="op">)</span>, <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">rnorm</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 19.86409</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 19.55834 22.30159</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 20.62193 23.06144 19.61896</span></span></code></pre></div>
<p>Use <code>.args</code> for constant arguments to <code>.f</code>, and
<code>...</code> for objects referenced in <code>.f</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">2345L</span><span class="op">)</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">range</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span> <span class="op">+</span> <span class="va">range</span><span class="op">)</span></span>
<span><span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fn</span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span><span class="op">)</span></span>
<span><span class="va">ml</span></span>
<span><span class="co">#&gt; &lt; mirai map [0/3] &gt;</span></span>
<span><span class="va">ml</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt; [1] 2.637793</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b</span></span>
<span><span class="co">#&gt; [1] 2.328183 5.649959</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $c</span></span>
<span><span class="co">#&gt; [1] 5.302906 3.531788 6.389231</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="collecting-options">Collecting Options<a class="anchor" aria-label="anchor" href="#collecting-options"></a>
</h4>
<ul>
<li>
<code>x[.flat]</code> flattens results (checks types to avoid
coercion)</li>
<li>
<code>x[.progress]</code> shows progress bar (via cli) or text
indicator</li>
<li>
<code>x[.stop]</code> applies early stopping, cancelling remaining
tasks on first failure</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="st">"a"</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">.stop</span><span class="op">]</span></span>
<span><span class="co">#&gt; Error in `mirai_map()`:</span></span>
<span><span class="co">#&gt; ℹ In index: 2.</span></span>
<span><span class="co">#&gt; ℹ With name: b.</span></span>
<span><span class="co">#&gt; Caused by error in `exp()`:</span></span>
<span><span class="co">#&gt; ! non-numeric argument to mathematical function</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>, <span class="va">Sys.sleep</span><span class="op">)</span><span class="op">[</span><span class="va">.progress</span>, <span class="va">.flat</span><span class="op">]</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multiple-map">Multiple Map<a class="anchor" aria-label="anchor" href="#multiple-map"></a>
</h4>
<p>Dataframes and matrices map over <strong>rows</strong>.
<code>.f</code> must accept as many arguments as there are columns:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fruit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"melon"</span>, <span class="st">"grapes"</span>, <span class="st">"coconut"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">fruit</span><span class="op">)</span>, fruit <span class="op">=</span> <span class="va">fruit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">sprintf</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%d. %s"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">.flat</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "1. melon"   "2. grapes"  "3. coconut"</span></span></code></pre></div>
<p>Matrices also map over rows:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow <span class="op">=</span> <span class="fl">2L</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="va">mat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">y</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">z</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span><span class="op">[</span><span class="va">.flat</span><span class="op">]</span></span>
<span><span class="co">#&gt;  a  b </span></span>
<span><span class="co">#&gt; 14 16</span></span>
<span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>To map over columns instead, use <code><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list()</a></code> for
dataframes or <code><a href="https://rdrr.io/r/base/t.html" class="external-link">t()</a></code> for matrices.</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="nested-maps">Nested Maps<a class="anchor" aria-label="anchor" href="#nested-maps"></a>
</h4>
<p>For nested mapping, don’t launch local daemons from within
<code><a href="../reference/mirai_map.html">mirai_map()</a></code>. Instead:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_local</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="remote-infrastructure">5. Remote Infrastructure<a class="anchor" aria-label="anchor" href="#remote-infrastructure"></a>
</h3>
<p>This section covers setting up remote daemons, launching them on
remote machines, and securing connections with TLS.</p>
<div class="section level4">
<h4 id="remote-daemons-overview">Remote Daemons Overview<a class="anchor" aria-label="anchor" href="#remote-daemons-overview"></a>
</h4>
<p>Remote daemons run on network machines to process tasks remotely.</p>
<p>Call <code><a href="../reference/daemons.html">daemons()</a></code> with a ‘url’ (e.g.,
‘tcp://10.75.32.70:5555’) or use <code><a href="../reference/host_url.html">host_url()</a></code> to construct
one automatically. The host listens on a single port for daemons to
connect.</p>
<blockquote>
<p>IPv6 addresses are also supported and must be enclosed in square
brackets <code>[]</code> to avoid confusion with the final colon
separating the port. For example, port 5555 on the IPv6 address
<code>::ffff:a6f:50d</code> would be specified as
<code>tcp://[::ffff:a6f:50d]:5555</code>.</p>
</blockquote>
<p>Calling <code><a href="../reference/host_url.html">host_url()</a></code> without a port uses ‘0’, which
automatically assigns a free ephemeral port:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Query the assigned port with <code><a href="../reference/status.html">status()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $connections</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $daemons</span></span>
<span><span class="co">#&gt; [1] "tcp://10.216.62.38:49515"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mirai</span></span>
<span><span class="co">#&gt;  awaiting executing completed </span></span>
<span><span class="co">#&gt;         0         0         0</span></span></code></pre></div>
<p>Dynamically scale the number of daemons up or down as needed.</p>
<p>Reset all connections:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Closing connections exits all daemons. With dispatcher, this exits
the dispatcher first, then all connected daemons.</p>
</div>
<div class="section level4">
<h4 id="launching-remote-daemons">Launching Remote Daemons<a class="anchor" aria-label="anchor" href="#launching-remote-daemons"></a>
</h4>
<blockquote>
<p>Launchers deploy daemons on remote machines. Once deployed, daemons
connect back to the host via TCP or TLS.</p>
</blockquote>
<p>Local launchers run <code>Rscript</code> via a local shell. Remote
launchers run <code>Rscript</code> on remote machines.</p>
<p>Supply a remote launch configuration to the ‘remote’ argument of
<code><a href="../reference/daemons.html">daemons()</a></code> or <code><a href="../reference/launch_local.html">launch_remote()</a></code>.</p>
<p>Three configuration options:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/ssh_config.html">ssh_config()</a></code> for SSH access</li>
<li>
<code><a href="../reference/cluster_config.html">cluster_config()</a></code> for HPC resource managers (Slurm, SGE,
Torque/PBS, LSF)</li>
<li>
<code><a href="../reference/remote_config.html">remote_config()</a></code> for generic/custom launchers</li>
</ol>
<p>All return simple lists that can be pre-constructed, saved, and
reused.</p>
</div>
<div class="section level4">
<h4 id="ssh-direct-connection">SSH Direct Connection<a class="anchor" aria-label="anchor" href="#ssh-direct-connection"></a>
</h4>
<p>Use for internal networks where the host can accept incoming
connections. Remote daemons connect back directly to the host port.</p>
<p>TLS is recommended for additional security.</p>
<p>Launch 4 daemons on 10.75.32.90 (SSH port 22 is default):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Launch one daemon on each machine using custom SSH port 222:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90:222"</span>, <span class="st">"ssh://10.75.32.91:222"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ssh-tunnelling">SSH Tunnelling<a class="anchor" aria-label="anchor" href="#ssh-tunnelling"></a>
</h4>
<p>Use SSH tunnelling when firewall policies prevent direct connections.
Requires SSH key-based authentication to be setup.</p>
<p>SSH tunnelling creates a tunnel after the initial SSH connection,
using the same port on both host and daemon.</p>
<p>Supply a ‘127.0.0.1’ URL to <code><a href="../reference/daemons.html">daemons()</a></code>:</p>
<ul>
<li>
<code>local_url(tcp = TRUE)</code> constructs this
automatically</li>
<li>Default wildcard port ‘0’ assigns a free ephemeral port</li>
<li>Specify a whitelisted port if the ephemeral port might be
unavailable on daemons</li>
</ul>
<p>With <code>local_url(tcp = TRUE, port = 5555)</code>, the host
listens at <code>127.0.0.1:5555</code> and daemons dial into
<code>127.0.0.1:5555</code> on their own machines.</p>
<p>Launch 2 daemons on 10.75.32.90 with tunnelling:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90"</span>, tunnel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="hpc-cluster-resource-managers">HPC Cluster Resource Managers<a class="anchor" aria-label="anchor" href="#hpc-cluster-resource-managers"></a>
</h4>
<p><code><a href="../reference/cluster_config.html">cluster_config()</a></code> deploys daemons via cluster resource
managers.</p>
<p>Specify <code>command</code>: - <code>"sbatch"</code> for Slurm -
<code>"qsub"</code> for SGE/Torque/PBS - <code>"bsub"</code> for LSF</p>
<p>The <code>options</code> argument accepts scheduler options (lines
typically preceded by <code>#</code>):</p>
<pre><code><span>  <span class="va">Slurm</span><span class="op">:</span> <span class="st">"#SBATCH --job-name=mirai</span></span>
<span><span class="st">          #SBATCH --mem=10G</span></span>
<span><span class="st">          #SBATCH --output=job.out"</span></span>
<span>  <span class="va">SGE</span><span class="op">:</span> <span class="st">"#$ -N mirai</span></span>
<span><span class="st">        #$ -l mem_free=10G</span></span>
<span><span class="st">        #$ -o job.out"</span></span>
<span>  <span class="va">Torque</span><span class="op">/</span><span class="va">PBS</span><span class="op">:</span> <span class="st">"#PBS -N mirai</span></span>
<span><span class="st">               #PBS -l mem=10gb</span></span>
<span><span class="st">               #PBS -o job.out"</span></span>
<span>  <span class="va">LSF</span><span class="op">:</span> <span class="st">"#BSUB -J mirai</span></span>
<span><span class="st">        #BSUB -M 10000</span></span>
<span><span class="st">        #BSUB -o job.out"</span></span></code></pre>
<ul>
<li>Pass as multi-line string (whitespace auto-handled) or use
<code>\n</code> for newlines</li>
<li>Include other shell commands (e.g., <code>cd</code> for working
directory)</li>
<li>Omit shebang lines (e.g., <code>#!/bin/bash</code>)</li>
<li>Load environment modules if needed:</li>
</ul>
<pre><code>module load R</code></pre>
<p>or for a specific R version:</p>
<pre><code>module load R/4.5.0</code></pre>
<p>The <code>rscript</code> argument defaults to <code>"Rscript"</code>
(assumes R is on PATH). Specify full path if needed:
<code>file.path(R.home("bin"), "Rscript")</code>.</p>
<div class="section level5">
<h5 id="job-arrays">Job Arrays<a class="anchor" aria-label="anchor" href="#job-arrays"></a>
</h5>
<p>For many daemons, use job arrays instead of individual jobs.</p>
<p>Instead of:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span>, remote <span class="op">=</span> <span class="fu"><a href="../reference/cluster_config.html">cluster_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>rather use:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/cluster_config.html">cluster_config</a></span><span class="op">(</span>options <span class="op">=</span> <span class="st">"#SBATCH --array=1-100"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="generic-remote-configuration">Generic Remote Configuration<a class="anchor" aria-label="anchor" href="#generic-remote-configuration"></a>
</h4>
<p><code><a href="../reference/remote_config.html">remote_config()</a></code> provides a generic framework for custom
deployment commands.</p>
<p>The <code>args</code> argument must contain <code>"."</code>, which
is replaced with the daemon launch command.</p>
<p><code><a href="../reference/cluster_config.html">cluster_config()</a></code> is easier for HPC, but
<code><a href="../reference/remote_config.html">remote_config()</a></code> offers flexibility. Slurm example:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/remote_config.html">remote_config</a></span><span class="op">(</span></span>
<span>    command <span class="op">=</span> <span class="st">"sbatch"</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--mem 512"</span>, <span class="st">"-n 1"</span>, <span class="st">"--wrap"</span>, <span class="st">"."</span><span class="op">)</span>,</span>
<span>    rscript <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Rhome.html" class="external-link">R.home</a></span><span class="op">(</span><span class="st">"bin"</span><span class="op">)</span>, <span class="st">"Rscript"</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="manual-deployment">Manual Deployment<a class="anchor" aria-label="anchor" href="#manual-deployment"></a>
</h4>
<p>Call <code><a href="../reference/launch_local.html">launch_remote()</a></code> without ‘remote’ to get shell
commands for manual deployment:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_remote</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]</span></span>
<span><span class="co">#&gt; Rscript -e 'mirai::daemon("tcp://10.216.62.38:49516")'</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tls-secure-connections">TLS Secure Connections<a class="anchor" aria-label="anchor" href="#tls-secure-connections"></a>
</h4>
<p>TLS secures communications between host and remote daemons.</p>
<div class="section level5">
<h5 id="automatic-zero-configuration-default">Automatic Zero-configuration Default<a class="anchor" aria-label="anchor" href="#automatic-zero-configuration-default"></a>
</h5>
<p>Use <code>tls+tcp://</code> scheme or
<code>host_url(tls = TRUE)</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Keys and certificates generate automatically. Private keys remain on
the host.</p>
<p>Self-signed certificates are included in <code><a href="../reference/launch_local.html">launch_remote()</a></code>
commands:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/launch_local.html">launch_remote</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]</span></span>
<span><span class="co">#&gt; Rscript -e 'mirai::daemon("tls+tcp://10.216.62.38:49517",tlscert=c("-----BEGIN CERTIFICATE-----</span></span>
<span><span class="co">#&gt; MIIFPzCCAyegAwIBAgIBATANBgkqhkiG9w0BAQsFADA3MRUwEwYDVQQDDAwxMC4y</span></span>
<span><span class="co">#&gt; MTYuNjIuMzgxETAPBgNVBAoMCE5hbm9uZXh0MQswCQYDVQQGEwJKUDAeFw0wMTAx</span></span>
<span><span class="co">#&gt; MDEwMDAwMDBaFw0zMDEyMzEyMzU5NTlaMDcxFTATBgNVBAMMDDEwLjIxNi42Mi4z</span></span>
<span><span class="co">#&gt; ODERMA8GA1UECgwITmFub25leHQxCzAJBgNVBAYTAkpQMIICIjANBgkqhkiG9w0B</span></span>
<span><span class="co">#&gt; AQEFAAOCAg8AMIICCgKCAgEAydxZw07AviS9yZjnYP9PL+x/TA5RGEbm+G0Iobct</span></span>
<span><span class="co">#&gt; ML2a/t8pk+cJ/hwpB8HA0i7eoc52Km8TCz2hturtGe3BS0mvvnzipcs9k2pxga6o</span></span>
<span><span class="co">#&gt; 3sqbLXvI19sC/CMu5gUWOU9dcFh6BYavVLpUW4j0xjjcXAr4PBBIjF+/Lt5FNWuZ</span></span>
<span><span class="co">#&gt; srPKC7Q6/ay7b8bFANEcYwZWkoXlWqhY/8EmOqECA97cdCybkfXcIFRU2SFMTQtx</span></span>
<span><span class="co">#&gt; NbpHqXWvtGKRQxwvYcfnlkLyQwJZr3CsB10gdPCeoXVPKCJf+ZoPQDGA2BH1jdHx</span></span>
<span><span class="co">#&gt; sxUVMIg9skMdciGHWM/zu+7urXn7HFMoMmXfSnsQSgJ46EnJSEqFQ5W2ZIstfnQE</span></span>
<span><span class="co">#&gt; tIZFmJqyIr3D6NOvwdk54lK7CkfWr17tcvWlTUhxRsJzR3/rWnQKAIx/R+eMsPfK</span></span>
<span><span class="co">#&gt; fP8ajpxhFXsfnyZF0U3onvU2L6qjKSUyj3NS4lpb85T5LN56Kp7OauZiqXNBV7b5</span></span>
<span><span class="co">#&gt; PCdgSMJljRSXYolMjk7B7KA1LbMigMJwLN5KfnvwUswS6B24XI4F2NmUJXe2nec7</span></span>
<span><span class="co">#&gt; Cy7iCiUYI2O1v2MKn0xWUHuJW21EJtPXoNBOBFA6Bpz93/Wf0m6MbSjUH7rf8Xgo</span></span>
<span><span class="co">#&gt; accxoffGXlE3oKwO/BMbbNwtHMupsdu5MMyv8TGD8F2NqE7b1eT57oDVkfzjGjwR</span></span>
<span><span class="co">#&gt; b1sCAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQU7J2cGBmo</span></span>
<span><span class="co">#&gt; ZcqDzBVYVQLcQUCQ5ccwHwYDVR0jBBgwFoAU7J2cGBmoZcqDzBVYVQLcQUCQ5ccw</span></span>
<span><span class="co">#&gt; DQYJKoZIhvcNAQELBQADggIBAHhjNztuQAaPsKKZWweaIY06jak24YsSG64zJBGj</span></span>
<span><span class="co">#&gt; dbMta7s4r4Sj8DaidEQMcVl4FeVO/3ZLtC9xDpq+QWQkj44Zi1gbOloEkbIy2TK7</span></span>
<span><span class="co">#&gt; cmfsPCP3sgjGt9+TAI2Fib5eBXHGH5eITCf99PBUC/rEHhd9LsBqih0gD0iRVZw8</span></span>
<span><span class="co">#&gt; PD7KiVUK6R5f0dpGfVvl4l0HEpOFNnq23w6JGZeyMmHbknW6o62VTh+7FtBEci6E</span></span>
<span><span class="co">#&gt; wwBoUK6lTujzDK3jTLdAPVipTad6yIBK1wgQBfWuGB8/U4Sbr9ji/+sQ5Yp9rUP6</span></span>
<span><span class="co">#&gt; aQis8f+KOmj2mxqsEj/NYwm22BmwufAy/5RmXg3S9gdfg2Lf3g73cJZOppd5B/AH</span></span>
<span><span class="co">#&gt; dL4G2Iym1c8PcT1UkkKDIIzfTHxV4vvyUsqoNX5aJcbmp/Qla7aXkO69ilkDzIjT</span></span>
<span><span class="co">#&gt; AypracLmZzve8NYtws196/bc1Lk93ezaER+AWODxCoquUDWjl2ybFrfnWhqJ1Z96</span></span>
<span><span class="co">#&gt; nK8w4u0LvA6D4JG1lG15XykY/CIj91rRpIaijg3qi0pAoU340YgiT5cKn6tOmBNe</span></span>
<span><span class="co">#&gt; EdPlZKBazZ3TXTST5NwiMEslLKyKj9htOEIfO0gDKwvb82bazG7SEn1bjxyvGCMb</span></span>
<span><span class="co">#&gt; DLZFvTcRrv+OT6sFYe8ii1umnwuI+PuRAboyU4ltTSoUaIV0kEvkFTzQBZf5mvrY</span></span>
<span><span class="co">#&gt; b8kO</span></span>
<span><span class="co">#&gt; -----END CERTIFICATE-----</span></span>
<span><span class="co">#&gt; ",""))'</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="ca-signed-certificates">CA Signed Certificates<a class="anchor" aria-label="anchor" href="#ca-signed-certificates"></a>
</h5>
<p>Alternatively, generate certificates via a Certificate Signing
Request (CSR) to a Certificate Authority (public or internal).</p>
<ol style="list-style-type: decimal">
<li>Generate a private key and CSR:</li>
</ol>
<ul>
<li>using Mbed TLS: <a href="https://mbed-tls.readthedocs.io/en/latest/kb/how-to/generate-a-certificate-request-csr/" class="external-link uri">https://mbed-tls.readthedocs.io/en/latest/kb/how-to/generate-a-certificate-request-csr/</a>
</li>
<li>using OpenSSL: <a href="https://www.feistyduck.com/library/openssl-cookbook/online/" class="external-link uri">https://www.feistyduck.com/library/openssl-cookbook/online/</a>
(Chapter 1.2 Key and Certificate Management)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Provide the generated CSR to the CA for it to sign a new TLS
certificate.</li>
</ol>
<ul>
<li>The common name (CN) of the certificate must be identical to the
hostname or IP address actually used for the connection. As this is
verified, it will fail if not the same.</li>
<li>The received certificate should comprise a block of cipher text
between the markers <code>-----BEGIN CERTIFICATE-----</code> and
<code>-----END CERTIFICATE-----</code>. Make sure to request the
certificate in the PEM format. If only available in other formats, the
TLS library used should usually provide conversion utilities.</li>
<li>Check also that the private key is a block of cipher text between
the markers <code>-----BEGIN PRIVATE KEY-----</code> and
<code>-----END PRIVATE KEY-----</code>.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>When setting daemons, the TLS certificate and private key should be
provided to the ‘tls’ argument of <code><a href="../reference/daemons.html">daemons()</a></code>.</li>
</ol>
<ul>
<li>If the certificate and private key have been imported as character
strings <code>cert</code> and <code>key</code> respectively, then the
‘tls’ argument may be specified as the character vector
<code>c(cert, key)</code>.</li>
<li>Alternatively, the certificate may be copied to a new text file,
with the private key appended, in which case the path/filename of this
file may be provided to the ‘tls’ argument.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>The certificate chain to the CA should be supplied to the ‘tlscert’
argument of <code><a href="../reference/daemons.html">daemons()</a></code>.</li>
</ol>
<ul>
<li>The certificate chain should comprise multiple certificates, each
between <code>-----BEGIN CERTIFICATE-----</code> and
<code>-----END CERTIFICATE-----</code> markers. The first one should be
the newly-generated TLS certificate, the same supplied to
<code><a href="../reference/daemons.html">daemons()</a></code>, and the final one should be a CA root
certificate.</li>
<li>These are the only certificates required if the certificate was
signed directly by a CA. If not, then the intermediate certificates
should be included in a certificate chain that starts with the TLS
certificate and ends with the certificate of the CA.</li>
<li>If these are concatenated together as a single character string
<code>certchain</code>, then the character vector comprising this and an
empty character string <code>c(certchain, "")</code> may be supplied to
‘tlscert’.</li>
<li>Alternatively, if these are written to a file (and the file
replicated on the remote machines), then the ‘tlscert’ argument may also
be specified as a path/filename (assuming these are the same on each
machine).</li>
</ul>
</div>
</div>
</div>
<div class="section level3">
<h3 id="compute-profiles">6. Compute Profiles<a class="anchor" aria-label="anchor" href="#compute-profiles"></a>
</h3>
<p>The <code>.compute</code> argument to <code><a href="../reference/daemons.html">daemons()</a></code> creates
separate, independent daemon sets (<em>compute profiles</em>) for
heterogeneous compute requirements:</p>
<ul>
<li>Target daemons with specific specs (CPUs, memory, GPU,
accelerators)</li>
<li>Split between local and remote computation</li>
</ul>
<p>Pass a character string to <code>.compute</code> as the profile name
(<code>NULL</code> defaults to ‘default’). Settings save under this
name.</p>
<p>Specify <code>.compute</code> in <code><a href="../reference/mirai.html">mirai()</a></code> to use a
profile (<code>NULL</code> uses ‘default’).</p>
<p>Other functions (<code><a href="../reference/status.html">status()</a></code>, <code><a href="../reference/launch_local.html">launch_local()</a></code>,
<code><a href="../reference/launch_local.html">launch_remote()</a></code>) also accept <code>.compute</code>.</p>
<div class="section level4">
<h4 id="with_daemons-and-local_daemons">
<code>with_daemons()</code> and <code>local_daemons()</code><a class="anchor" aria-label="anchor" href="#with_daemons-and-local_daemons"></a>
</h4>
<p><code><a href="../reference/with_daemons.html">with_daemons()</a></code> or <code><a href="../reference/with_daemons.html">local_daemons()</a></code> with a
profile name sets the default for all functions within that scope:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">1</span>, .compute <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">1</span>, .compute <span class="op">=</span> <span class="st">"gpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"cpu"</span>, <span class="op">{</span></span>
<span>  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"gpu"</span>, <span class="op">{</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span>, .compute <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/with_daemons.html">local_daemons</a></span><span class="op">(</span><span class="st">"cpu"</span><span class="op">)</span></span>
<span>  <span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="va">daemons</span></span>
<span><span class="co">#&gt; [1] "ipc:///tmp/79b5fc7a162b5413cdd1b0e6"</span></span>
<span><span class="va">m1</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 12700</span></span>
<span></span>
<span><span class="va">s2</span><span class="op">$</span><span class="va">daemons</span></span>
<span><span class="co">#&gt; [1] "ipc:///tmp/5710972c9d0d836a64e8c45a"</span></span>
<span><span class="va">m2</span><span class="op">[</span><span class="op">]</span> <span class="co"># different to m1</span></span>
<span><span class="co">#&gt; [1] 12726</span></span>
<span></span>
<span><span class="va">m3</span><span class="op">[</span><span class="op">]</span> <span class="co"># same as m1</span></span>
<span><span class="co">#&gt; [1] 12700</span></span>
<span><span class="va">m4</span><span class="op">[</span><span class="op">]</span> <span class="co"># same as m1</span></span>
<span><span class="co">#&gt; [1] 12700</span></span>
<span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"cpu"</span>, <span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"gpu"</span>, <span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="with-method">With Method<a class="anchor" aria-label="anchor" href="#with-method"></a>
</h4>
<p>The <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> method creates daemons for an expression’s
duration, then automatically resets them. Functions within the scope use
the daemons’ compute profile.</p>
<p>Designed for running Shiny apps with specific daemon counts:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="fu">shiny</span><span class="fu">::</span><span class="fu">runApp</span><span class="op">(</span><span class="va">app</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Or:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, .compute <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span>, <span class="fu">shiny</span><span class="fu">::</span><span class="fu">runApp</span><span class="op">(</span><span class="va">app</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: The app must already be created. Don’t wrap
<code>shiny::shinyApp()</code> since <code>runApp()</code> is called
when printed, after <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> returns.</p>
</blockquote>
<p>Shiny apps execute all mirai calls before returning (blocking). For
other expressions, collect all mirai values to ensure completion before
daemon reset.</p>
</div>
</div>
<div class="section level3">
<h3 id="advanced-topics">7. Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h3>
<div class="section level4">
<h4 id="random-number-generation">Random Number Generation<a class="anchor" aria-label="anchor" href="#random-number-generation"></a>
</h4>
<p>mirai uses L’Ecuyer-CMRG streams (like base R’s parallel package) for
statistically-sound parallel RNG.</p>
<p>Streams divide the RNG sequence at far-apart intervals that don’t
overlap, ensuring valid parallel results.</p>
<p><strong>Default (<code>seed = NULL</code>)</strong>: New stream per
daemon (like base R):</p>
<ul>
<li>Statistically sound but not numerically reproducible across
runs</li>
<li>Different daemon counts send tasks to different daemons</li>
<li>Dispatcher sends tasks dynamically (not guaranteed same daemon each
run)</li>
</ul>
<p><strong>Reproducible (<code>seed = integer</code>)</strong>: New
stream per <code><a href="../reference/mirai.html">mirai()</a></code> call (not per daemon):</p>
<ul>
<li>Deterministic, reproducible results</li>
<li>Regardless of daemon count</li>
<li>Negligible performance impact</li>
</ul>
</div>
<div class="section level4">
<h4 id="synchronous-mode">Synchronous Mode<a class="anchor" aria-label="anchor" href="#synchronous-mode"></a>
</h4>
<p><code>daemons(sync = TRUE)</code> enables synchronous mode. Mirai
evaluate immediately without async operation, useful for testing and
debugging with <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>.</p>
<p>Restrict to a specific profile by specifying <code>.compute</code>.
Only <code>seed</code> affects behavior with
<code>sync = TRUE</code>.</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run everything in sync:</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>sync <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 4978</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 4978</span></span>
<span></span>
<span></span>
<span><span class="co"># Use sync with the 'sync' compute profile:</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>sync <span class="op">=</span> <span class="cn">TRUE</span>, .compute <span class="op">=</span> <span class="st">"sync"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"sync"</span>, <span class="op">{</span></span>
<span>  <span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span>, .compute <span class="op">=</span> <span class="st">"sync"</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 4978</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 4978</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/shikokuchuo" class="external-link">Charlie Gao</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
