<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>For Package Authors • mirai</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="For Package Authors">
<meta name="robots" content="noindex">
<script defer data-domain="mirai.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mirai</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.4.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mirai.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/mirai-map.html">Mirai Map</a></li>
    <li><a class="dropdown-item" href="../articles/mirai-promises.html">Promises - Shiny and Plumber</a></li>
    <li><a class="dropdown-item" href="../articles/mirai-serialization.html">Serialization - Arrow, ADBC, polars, torch</a></li>
    <li><a class="dropdown-item" href="../articles/mirai-xparallel.html">Communications Backend for R</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">For Package Authors</a></li>
    <li><a class="dropdown-item" href="../articles/questions.html">Community FAQs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/27-mirai-240/">mirai 2.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/26-mirai-230/">mirai 2.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/25-mirai-v2/">mirai 2.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/mirai/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>For Package Authors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/mirai/blob/main/vignettes/packages.Rmd" class="external-link"><code>vignettes/packages.Rmd</code></a></small>
      <div class="d-none name"><code>packages.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="developer-interfaces">1. Developer Interfaces<a class="anchor" aria-label="anchor" href="#developer-interfaces"></a>
</h3>
<p>mirai offers the following functions primarily for package authors
using mirai:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/require_daemons.html">require_daemons()</a></code> will error and prompt the user to set
daemons (with a clickable function link if the cli package is available)
if daemons are not already set.</li>
<li>
<code><a href="../reference/daemons_set.html">daemons_set()</a></code>, to detect if daemons have already been
set and prompt the user to set daemons if not.</li>
<li>
<code><a href="../reference/on_daemon.html">on_daemon()</a></code>, to detect if code is already running on a
daemon, i.e. within a <code><a href="../reference/mirai.html">mirai()</a></code> call.</li>
<li>
<code><a href="../reference/register_serial.html">register_serial()</a></code> to register custom serialization
functions, which are automatically available by default for all
subsequent <code><a href="../reference/daemons.html">daemons()</a></code> calls.</li>
<li>
<code><a href="../reference/nextstream.html">nextget()</a></code>, for querying values for a compute profile,
such as ‘url’, described in the function’s documentation. Note: only the
specifically-documented values are supported interfaces.</li>
</ol>
</div>
<div class="section level3">
<h3 id="guidance">2. Guidance<a class="anchor" aria-label="anchor" href="#guidance"></a>
</h3>
<p>mirai as a framework is designed to support completely transparent
and inter-operable use within packages. A core design precept of not
relying on global options or environment variables minimises the
likelihood of conflict between use by different packages.</p>
<p>There are hence only a few important points to note:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/daemons.html">daemons()</a></code> settings should wherever possible be left to
end-users. This means that as a package author, you should just consider
that mirai are run on whatever resources are available to the user at
the time the code is run. You do not need to anticipate whether an
end-user will run the code on their own machine, distributed over the
network, or a mixture of both.</li>
</ol>
<ul>
<li>Consider pointing to the documentation for
<code><a href="../reference/daemons.html">mirai::daemons()</a></code>, or re-exporting <code><a href="../reference/daemons.html">daemons()</a></code> in
your package as a convenience.</li>
<li>Never include a call to <code><a href="../reference/daemons.html">daemons()</a></code> when using
<code><a href="../reference/mirai_map.html">mirai_map()</a></code>. This is important to ensure that there is no
accidental recursive creation of daemons on the same machine, for
example if your function is used within another package’s function that
also uses mirai.</li>
<li>Exceptionally, a
<code>daemons(n = 1, dispatcher = FALSE, .compute = ...)</code> call may
be used to set up a single dedicated daemon, but only if used with a
unique value for <code>.compute</code>. A representative example of this
usage pattern is <code>logger::appender_async()</code>, where the logger
package’s ‘namespace’ concept maps directly to mirai’s ‘compute
profile’.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>The shape and contents of a <code><a href="../reference/status.html">status()</a></code> call must not be
used programatically, as this user interface is subject to change at any
time. Use <code><a href="../reference/nextstream.html">nextget()</a></code> where possible instead.</li>
</ol>
<ul>
<li>An exception is that <code>status()$connections</code> may be used
to return the total number of daemon connections at any time.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>The functions <code><a href="../reference/unresolved.html">unresolved()</a></code>,
<code><a href="../reference/is_mirai_error.html">is_error_value()</a></code>, <code><a href="../reference/is_mirai_error.html">is_mirai_error()</a></code>, and
<code><a href="../reference/is_mirai_error.html">is_mirai_interrupt()</a></code> should be used to test for the
relevant state of a mirai or its value.</li>
</ol>
<ul>
<li>The characteristics of their current implementation, e.g. as a
logical NA for an ‘unresolvedValue’, should not be relied upon, as these
are subject to change at any time.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>For CRAN packages, all examples and tests should respect the
following rules when running on CRAN:</li>
</ol>
<ul>
<li>Use only one daemon (with <code>dispatcher = FALSE</code>) to ensure
that only one additional process is used, to remain within the 2-core
limit.</li>
<li>Always reset daemons at the end of each example or test file. Allow
at least a one-second sleep to ensure that all background processes have
properly exited and that no ‘detritus’ from the processes remains.</li>
<li>Never modify the default value of <code>asyncdial</code> or
<code>autoexit</code> for <code><a href="../reference/daemon.html">daemon()</a></code>, in that function or any
functions that pass arguments through to it such as
<code><a href="../reference/daemons.html">daemons()</a></code>. This is to ensure that processes exit as soon as
the host process does.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Charlie Gao, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
