<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mirai - Quick Reference • mirai</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mirai - Quick Reference">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-hide-below="1200" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="mirai.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mirai</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.5.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/mirai.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-reference.html">mirai - Reference Manual</a></li>
    <li><a class="dropdown-item" href="../articles/v02-promises.html">mirai - Promises (Shiny and Plumber)</a></li>
    <li><a class="dropdown-item" href="../articles/v03-serialization.html">mirai - Serialization (Arrow, ADBC, polars, torch)</a></li>
    <li><a class="dropdown-item" href="../articles/v04-parallel.html">mirai - Communications Backend for R</a></li>
    <li><a class="dropdown-item" href="../articles/v05-opentelemetry.html">mirai - OpenTelemetry</a></li>
    <li><a class="dropdown-item" href="../articles/v06-packages.html">mirai - For Package Authors</a></li>
    <li><a class="dropdown-item" href="../articles/v07-questions.html">mirai - Community FAQs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/09/mirai-2-5-0/">mirai 2.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/27-mirai-240/">mirai 2.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://shikokuchuo.net/posts/26-mirai-230/">mirai 2.3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/mirai/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>

     <a href="https://deepwiki.com/r-lib/mirai" class="external-link"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>

  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mirai - Quick Reference</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/mirai/blob/main/vignettes/mirai.Rmd" class="external-link"><code>vignettes/mirai.Rmd</code></a></small>
      <div class="d-none name"><code>mirai.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="core-concepts">Core Concepts<a class="anchor" aria-label="anchor" href="#core-concepts"></a>
</h2>
<p><strong>mirai</strong> = <em>future</em> in Japanese. Async
evaluation framework for R built on NNG/nanonext.</p>
<p><strong>Architecture</strong>: daemons dial into host, a topology
which facilitates dynamic scaling.</p>
<p>This is a cheatsheet. Refer to the <a href="v01-reference.html">mirai
reference manual</a> for a detailed introduction.</p>
</div>
<div class="section level2">
<h2 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h2>
<ul>
<li>
<strong><code><a href="../reference/mirai.html">mirai()</a></code></strong> returns immediately, access
result via <code>m[]</code> or <code>m$data</code>
</li>
<li>
<strong><code><a href="../reference/daemons.html">daemons()</a></code></strong> sets persistent background
processes</li>
<li>
<strong>Dispatcher</strong> enabled by default for optimal
scheduling</li>
<li>
<strong>SSH tunnelling</strong>: Use
<code>local_url(tcp=TRUE)</code> + <code>tunnel=TRUE</code> when ports
blocked</li>
<li>
<strong>HPC clusters</strong>: Use <code><a href="../reference/cluster_config.html">cluster_config()</a></code>
with appropriate scheduler</li>
<li>
<strong>Compute profiles</strong>: Multiple independent daemon sets
with <code>.compute</code> parameter</li>
<li>
<strong><code><a href="../reference/mirai_map.html">mirai_map()</a></code></strong>: Parallel map with
progress bars, early stopping, flatmap</li>
</ul>
</div>
<div class="section level2">
<h2 id="basic-mirai-usage">1. Basic mirai Usage<a class="anchor" aria-label="anchor" href="#basic-mirai-usage"></a>
</h2>
<div class="section level3">
<h3 id="create-and-access-results">Create and Access Results<a class="anchor" aria-label="anchor" href="#create-and-access-results"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org">mirai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a mirai (returns immediately)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Direct access (non-blocking)</span></span>
<span><span class="fu"><a href="../reference/unresolved.html">unresolved</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>              <span class="co"># Check if resolved (TRUE if still running)</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span>                     <span class="co"># Returns value (NA if unresolved)</span></span>
<span></span>
<span><span class="co"># Access result (blocks until ready)</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="op">]</span>                        <span class="co"># Wait and return value</span></span>
<span><span class="fu"><a href="../reference/collect_mirai.html">collect_mirai</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>           <span class="co"># Wait and return value</span></span>
<span><span class="fu"><a href="../reference/call_mirai.html">call_mirai</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>              <span class="co"># Wait and return mirai object</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="passing-data">Passing Data<a class="anchor" aria-label="anchor" href="#passing-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Via ... (assigned to daemon global env)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">func</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, func <span class="op">=</span> <span class="va">my_func</span>, x <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Via .args (local to evaluation env)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">func</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>func <span class="op">=</span> <span class="va">my_func</span>, x <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pass entire environment</span></span>
<span><span class="va">write_async</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">file</span><span class="op">)</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="local-daemons">2. Local Daemons<a class="anchor" aria-label="anchor" href="#local-daemons"></a>
</h2>
<div class="section level3">
<h3 id="basic-setup">Basic Setup<a class="anchor" aria-label="anchor" href="#basic-setup"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set 4 local daemons (with dispatcher - default)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Without dispatcher (round-robin distribution)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, dispatcher <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset daemons</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check connection / statistics</span></span>
<span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="daemon-configuration">Daemon Configuration<a class="anchor" aria-label="anchor" href="#daemon-configuration"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">TRUE</span>,          <span class="co"># Use dispatcher for optimal FIFO scheduling</span></span>
<span>  cleanup <span class="op">=</span> <span class="cn">TRUE</span>,             <span class="co"># Clean env between tasks</span></span>
<span>  output <span class="op">=</span> <span class="cn">FALSE</span>,             <span class="co"># Capture stdout/stderr</span></span>
<span>  maxtasks <span class="op">=</span> <span class="cn">Inf</span>,             <span class="co"># Task limit per daemon</span></span>
<span>  idletime <span class="op">=</span> <span class="cn">Inf</span>,             <span class="co"># Max idle time (ms) before exit</span></span>
<span>  walltime <span class="op">=</span> <span class="cn">Inf</span>              <span class="co"># Time limit (ms) before exit</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="synchronous-mode-testingdebugging">Synchronous Mode (Testing/Debugging)<a class="anchor" aria-label="anchor" href="#synchronous-mode-testingdebugging"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>sync <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>          <span class="co"># Run in current process</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="remote-daemons---ssh-direct">3. Remote Daemons - SSH Direct<a class="anchor" aria-label="anchor" href="#remote-daemons---ssh-direct"></a>
</h2>
<div class="section level3">
<h3 id="setup-host-to-accept-remote-connections">Setup Host to Accept Remote Connections<a class="anchor" aria-label="anchor" href="#setup-host-to-accept-remote-connections"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Listen at host URL with TLS</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90"</span>, <span class="st">"ssh://node2:22"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or without automatic launching</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_remote</a></span><span class="op">(</span><span class="fl">2</span>, remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="url-constructors">URL Constructors<a class="anchor" aria-label="anchor" href="#url-constructors"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span>                    <span class="co"># Auto-detect IP, tcp://x.x.x.x:0</span></span>
<span><span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>          <span class="co"># TLS connection</span></span>
<span><span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span>  <span class="co"># Specific port</span></span>
<span></span>
<span><span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span><span class="op">)</span>                   <span class="co"># IPC (Unix sockets/named pipes)</span></span>
<span><span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>         <span class="co"># tcp://127.0.0.1:0</span></span>
<span><span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span> <span class="co"># tcp://127.0.0.1:5555</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ssh-configuration">SSH Configuration<a class="anchor" aria-label="anchor" href="#ssh-configuration"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span></span>
<span>  remotes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssh://node1:22"</span>, <span class="st">"ssh://node2:22"</span><span class="op">)</span>,</span>
<span>  tunnel <span class="op">=</span> <span class="cn">FALSE</span>,             <span class="co"># Direct connection</span></span>
<span>  timeout <span class="op">=</span> <span class="fl">10</span>,               <span class="co"># Connection timeout (seconds)</span></span>
<span>  command <span class="op">=</span> <span class="st">"ssh"</span>,            <span class="co"># SSH executable</span></span>
<span>  rscript <span class="op">=</span> <span class="st">"Rscript"</span>         <span class="co"># R executable on remote</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Requirements for SSH Direct</strong>:</p>
<ul>
<li>SSH key-based authentication in place</li>
<li>Host port open to inbound connections from remote</li>
<li>Remotes dial back to host URL directly</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="remote-daemons---ssh-tunnelling">4. Remote Daemons - SSH Tunnelling<a class="anchor" aria-label="anchor" href="#remote-daemons---ssh-tunnelling"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-tunnelling">When to Use Tunnelling<a class="anchor" aria-label="anchor" href="#when-to-use-tunnelling"></a>
</h3>
<ul>
<li>Firewall blocks inbound connections to host</li>
<li>Security policies prevent opening ports</li>
<li>Connecting to cloud/external machines</li>
</ul>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Host uses localhost URL</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,              <span class="co"># tcp://127.0.0.1:0</span></span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://10.75.32.90"</span>, tunnel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or with specific port</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span>, <span class="co"># tcp://127.0.0.1:5555</span></span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://remote-server"</span>, tunnel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>How Tunnelling Works</strong>:</p>
<ol style="list-style-type: decimal">
<li>Host listens on 127.0.0.1:port</li>
<li>SSH creates reverse tunnel: remote port -&gt; host port</li>
<li>Remote daemons dial into their own 127.0.0.1:port</li>
<li>Traffic tunnels back through SSH connection</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="hpc-cluster-configurations">5. HPC Cluster Configurations<a class="anchor" aria-label="anchor" href="#hpc-cluster-configurations"></a>
</h2>
<div class="section level3">
<h3 id="general-pattern">General Pattern<a class="anchor" aria-label="anchor" href="#general-pattern"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/cluster_config.html">cluster_config</a></span><span class="op">(</span></span>
<span>    command <span class="op">=</span> <span class="st">"sbatch"</span>,  <span class="co"># Scheduler command: "sbatch", "qsub", "bsub", etc.</span></span>
<span>    options <span class="op">=</span> <span class="st">"#SBATCH --job-name=mirai</span></span>
<span><span class="st">               #SBATCH --mem=16G</span></span>
<span><span class="st">               #SBATCH --cpus-per-task=1</span></span>
<span><span class="st">               #SBATCH --output=mirai_%j.out</span></span>
<span><span class="st">               #SBATCH --error=mirai_%j.err</span></span>
<span><span class="st">               module load R/4.5.0"</span>,</span>
<span>    rscript <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Rhome.html" class="external-link">R.home</a></span><span class="op">(</span><span class="st">"bin"</span><span class="op">)</span>, <span class="st">"Rscript"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scheduler-specific-directives">Scheduler-Specific Directives<a class="anchor" aria-label="anchor" href="#scheduler-specific-directives"></a>
</h3>
<table class="table">
<colgroup>
<col width="25%">
<col width="20%">
<col width="22%">
<col width="18%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>Scheduler</th>
<th>Command</th>
<th>Job Name</th>
<th>Memory</th>
<th>CPUs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Slurm</strong></td>
<td><code>sbatch</code></td>
<td><code>#SBATCH --job-name=NAME</code></td>
<td><code>--mem=16G</code></td>
<td><code>--cpus-per-task=1</code></td>
</tr>
<tr class="even">
<td><strong>SGE</strong></td>
<td><code>qsub</code></td>
<td><code>#$ -N NAME</code></td>
<td><code>-l mem_free=16G</code></td>
<td><code>-pe smp 1</code></td>
</tr>
<tr class="odd">
<td><strong>Torque/PBS</strong></td>
<td><code>qsub</code></td>
<td><code>#PBS -N NAME</code></td>
<td><code>-l mem=16gb</code></td>
<td><code>-l nodes=1:ppn=1</code></td>
</tr>
<tr class="even">
<td><strong>LSF</strong></td>
<td><code>bsub</code></td>
<td><code>#BSUB -J NAME</code></td>
<td><code>-M 16000</code></td>
<td><code>-n 1</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="manual-daemon-deployment">6. Manual Daemon Deployment<a class="anchor" aria-label="anchor" href="#manual-daemon-deployment"></a>
</h2>
<div class="section level3">
<h3 id="generate-launch-commands">Generate Launch Commands<a class="anchor" aria-label="anchor" href="#generate-launch-commands"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set daemons to listen</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get launch commands (doesn't execute)</span></span>
<span><span class="va">cmds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/launch_local.html">launch_remote</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="../reference/remote_config.html">remote_config</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Empty config returns commands</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Copy/paste commands to run on remote machines</span></span>
<span><span class="co"># E.g. Rscript -e "mirai::daemon('tcp://10.75.32.70:5555')"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cmds</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="compute-profiles">7. Compute Profiles<a class="anchor" aria-label="anchor" href="#compute-profiles"></a>
</h2>
<div class="section level3">
<h3 id="multiple-independent-profiles">Multiple Independent Profiles<a class="anchor" aria-label="anchor" href="#multiple-independent-profiles"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create CPU profile</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, .compute <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create GPU profile</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">2</span>, .compute <span class="op">=</span> <span class="st">"gpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Direct tasks to specific profile</span></span>
<span><span class="va">m_cpu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">heavy_compute</span><span class="op">(</span><span class="op">)</span>, .compute <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span><span class="va">m_gpu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">gpu_task</span><span class="op">(</span><span class="op">)</span>, .compute <span class="op">=</span> <span class="st">"gpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset specific profile</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">0</span>, .compute <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scoped-profiles">Scoped Profiles<a class="anchor" aria-label="anchor" href="#scoped-profiles"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Temporarily use profile</span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">with_daemons</a></span><span class="op">(</span><span class="st">"gpu"</span>, <span class="op">{</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">train_model</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set profile for scope</span></span>
<span><span class="fu"><a href="../reference/with_daemons.html">local_daemons</a></span><span class="op">(</span><span class="st">"cpu"</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">task</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Uses "cpu" profile</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-patterns">8. Common Patterns<a class="anchor" aria-label="anchor" href="#common-patterns"></a>
</h2>
<div class="section level3">
<h3 id="temporary-daemons">Temporary Daemons<a class="anchor" aria-label="anchor" href="#temporary-daemons"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">task1</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">task2</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m1</span><span class="op">[</span><span class="op">]</span>, <span class="va">m2</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Daemons auto-reset on exit</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mixed-localremote-resources">Mixed Local/Remote Resources<a class="anchor" aria-label="anchor" href="#mixed-localremote-resources"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_local</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>             <span class="co"># 2 local daemons</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_remote</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="st">"ssh://remote"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 4 remote</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-scaling">Dynamic Scaling<a class="anchor" aria-label="anchor" href="#dynamic-scaling"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Start listening</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_local</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>   <span class="co"># Add 2 daemons</span></span>
<span><span class="co"># Later...</span></span>
<span><span class="co"># Add 2 more (automatically exit after idle for 60 secs)</span></span>
<span><span class="fu"><a href="../reference/launch_local.html">launch_local</a></span><span class="op">(</span><span class="fl">2</span>, idletime <span class="op">=</span> <span class="fl">60000</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mirai_map---parallel-map">9. mirai_map - Parallel Map<a class="anchor" aria-label="anchor" href="#mirai_map---parallel-map"></a>
</h2>
<div class="section level3">
<h3 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simple map</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">sqrt</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># With additional arguments</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  <span class="va">rnorm</span>,</span>
<span>  .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># With helper functions</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">helper</span><span class="op">)</span>,</span>
<span>  helper <span class="op">=</span> <span class="va">my_helper_func</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collection-options">Collection Options<a class="anchor" aria-label="anchor" href="#collection-options"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flatten to vector</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">rnorm</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">.flat</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Progress bar</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="va">slow_func</span><span class="op">)</span><span class="op">[</span><span class="va">.progress</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Early stopping on error</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">process</span><span class="op">)</span><span class="op">[</span><span class="va">.stop</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Combine options</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="va">task</span><span class="op">)</span><span class="op">[</span><span class="va">.stop</span>, <span class="va">.progress</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-map-over-dataframematrix">Multiple Map (over DataFrame/Matrix)<a class="anchor" aria-label="anchor" href="#multiple-map-over-dataframematrix"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map over dataframe rows</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="va">df</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="va">.flat</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Map over matrix rows</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow <span class="op">=</span> <span class="fl">3</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mirai_map.html">mirai_map</a></span><span class="op">(</span><span class="va">mat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="error-handling">10. Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"error"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Test error types</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_error</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>      <span class="co"># Execution error</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_mirai_interrupt</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>  <span class="co"># User interrupt</span></span>
<span><span class="fu"><a href="../reference/is_mirai_error.html">is_error_value</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>      <span class="co"># Any error (catch-all)</span></span>
<span></span>
<span><span class="co"># Access error details</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">stack.trace</span>          <span class="co"># Full stack trace</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">condition.class</span>      <span class="co"># Original error classes</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">message</span>              <span class="co"># Error message</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="monitoring-and-status">11. Monitoring and Status<a class="anchor" aria-label="anchor" href="#monitoring-and-status"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span><span class="op">)</span>                    <span class="co"># Detailed status</span></span>
<span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="op">)</span>                      <span class="co"># Concise statistics</span></span>
<span></span>
<span><span class="fu"><a href="../reference/daemons_set.html">daemons_set</a></span><span class="op">(</span><span class="op">)</span>               <span class="co"># Check if daemons exist</span></span>
<span><span class="fu"><a href="../reference/require_daemons.html">require_daemons</a></span><span class="op">(</span><span class="op">)</span>           <span class="co"># Error if not set</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="advanced-features">12. Advanced Features<a class="anchor" aria-label="anchor" href="#advanced-features"></a>
</h2>
<div class="section level3">
<h3 id="timeouts">Timeouts<a class="anchor" aria-label="anchor" href="#timeouts"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Per-mirai timeout (requires dispatcher for auto-cancellation)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, .timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>  <span class="co"># 1 second</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="op">]</span>  <span class="co"># Returns errorValue 5 (timed out)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cancellation">Cancellation<a class="anchor" aria-label="anchor" href="#cancellation"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cancel mirai (requires dispatcher)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/stop_mirai.html">stop_mirai</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># Attempts cancellation</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">data</span>         <span class="co"># errorValue 20 (canceled)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluation-everywhere">Evaluation Everywhere<a class="anchor" aria-label="anchor" href="#evaluation-everywhere"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package on all daemons</span></span>
<span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export variables to all daemons</span></span>
<span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="va">config</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export variables to all daemons</span></span>
<span><span class="fu"><a href="../reference/everywhere.html">everywhere</a></span><span class="op">(</span><span class="op">{</span><span class="op">}</span>, db_conn <span class="op">=</span> <span class="va">my_conn</span>, api_key <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-seeds-reproducible">Random Seeds (Reproducible)<a class="anchor" aria-label="anchor" href="#random-seeds-reproducible"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Statistically-sound but non-reproducible (default)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reproducible RNG (seed per mirai call)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-serialization">Custom Serialization<a class="anchor" aria-label="anchor" href="#custom-serialization"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For torch tensors, Arrow tables, Polars objects</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  <span class="fl">4</span>,</span>
<span>  serial <span class="op">=</span> <span class="fu"><a href="../reference/serial_config.html">serial_config</a></span><span class="op">(</span></span>
<span>    <span class="st">"torch_tensor"</span>,</span>
<span>    sfunc <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="va">torch_serialize</span>,</span>
<span>    ufunc <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="va">torch_load</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Global registration</span></span>
<span><span class="fu"><a href="../reference/register_serial.html">register_serial</a></span><span class="op">(</span><span class="st">"torch_tensor"</span>, <span class="fu">torch</span><span class="fu">::</span><span class="va">torch_serialize</span>, <span class="fu">torch</span><span class="fu">::</span><span class="va">torch_load</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>  <span class="co"># Auto-applies registered configs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tls-configuration">TLS Configuration<a class="anchor" aria-label="anchor" href="#tls-configuration"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Auto TLS (zero-config certificates)</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom certificate</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  tls <span class="op">=</span> <span class="st">"/path/to/cert.pem"</span>,</span>
<span>  pass <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu">askpass</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.r-universe.dev/askpass/reference/askpass.html" class="external-link">askpass</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="dispatcher-vs--direct">13. Dispatcher vs. Direct<a class="anchor" aria-label="anchor" href="#dispatcher-vs--direct"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Feature</th>
<th>With Dispatcher (default)</th>
<th>Direct (dispatcher=FALSE)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Scheduling</td>
<td>Optimal FIFO</td>
<td>Round-robin</td>
</tr>
<tr class="even">
<td>Timeouts</td>
<td>✓</td>
<td>No auto-cancellation</td>
</tr>
<tr class="odd">
<td>Cancellation</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td>Serialization</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="odd">
<td>Overhead</td>
<td>Slightly higher</td>
<td>Minimal</td>
</tr>
<tr class="even">
<td>Use case</td>
<td>Variable task times</td>
<td>Similar task times</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="quick-decision-tree">14. Quick Decision Tree<a class="anchor" aria-label="anchor" href="#quick-decision-tree"></a>
</h2>
<pre><code>┌─ Need async in R?
│
├─ Single task → mirai()
│  └─ No daemons set? → ephemeral (auto-creates process)
│
├─ Map operation → mirai_map()
│  └─ Requires daemons() to be set first
│
└─ Multiple tasks → Set up daemons
   │
   ├─ Local only
   │  └─ daemons(n)
   │
   ├─ Remote with open ports
   │  └─ daemons(url = host_url(), remote = ssh_config(..., tunnel = FALSE))
   │
   ├─ Remote with firewall/blocked ports
   │  └─ daemons(url = local_url(tcp = TRUE), remote = ssh_config(..., tunnel = TRUE))
   │
   └─ HPC cluster (Slurm/SGE/PBS/LSF)
      └─ daemons(url = host_url(), remote = cluster_config(...))</code></pre>
</div>
<div class="section level2">
<h2 id="common-gotchas">15. Common Gotchas<a class="anchor" aria-label="anchor" href="#common-gotchas"></a>
</h2>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expression Evaluation</span></span>
<span><span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">pkg</span><span class="fu">::</span><span class="fu">func</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># Namespace functions OR library() inside expression</span></span>
<span><span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">func</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, func <span class="op">=</span> <span class="va">my_func</span>, x <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># Pass dependencies explicitly via ... or .args</span></span>
<span></span>
<span><span class="co"># Dispatcher Required For</span></span>
<span><span class="fu"><a href="../reference/stop_mirai.html">stop_mirai</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>                           <span class="co"># Cancellation</span></span>
<span><span class="fu"><a href="../reference/mirai.html">mirai</a></span><span class="op">(</span><span class="fu">task</span><span class="op">(</span><span class="op">)</span>, .timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>          <span class="co"># Timeout cancellation</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span><span class="fl">4</span>, serial <span class="op">=</span> <span class="fu"><a href="../reference/serial_config.html">serial_config</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="co"># Custom serialization</span></span>
<span></span>
<span><span class="co"># SSH Tunnelling</span></span>
<span><span class="fu"><a href="../reference/daemons.html">daemons</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="../reference/host_url.html">local_url</a></span><span class="op">(</span>tcp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, remote <span class="op">=</span> <span class="fu"><a href="../reference/ssh_config.html">ssh_config</a></span><span class="op">(</span><span class="va">...</span>, tunnel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Must use 127.0.0.1 (not external IP) + tunnel = TRUE</span></span>
<span></span>
<span><span class="co"># TLS</span></span>
<span><span class="fu"><a href="../reference/host_url.html">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                    <span class="co"># Auto TLS (zero-config, just works)</span></span>
<span><span class="co"># Custom certs: provide cert path + optional passphrase function</span></span>
<span></span>
<span><span class="co"># Remote Prerequisites</span></span>
<span><span class="co"># - SSH key-based auth configured beforehand</span></span>
<span><span class="co"># - SSH direct: host port open to inbound connections</span></span>
<span><span class="co"># - HPC: correct module load commands and scheduler directives</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/shikokuchuo" class="external-link">Charlie Gao</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
